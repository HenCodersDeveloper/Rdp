name: Windows Latest RDP

on: 
  workflow_dispatch

jobs:
  build:
    runs-on: windows-latest  # Menggunakan sistem operasi Windows terbaru

    timeout-minutes: 9999

    steps:
    - name: Download Required Files
      run: |
        Invoke-WebRequest https://raw.githubusercontent.com/HenCodersDeveloper/Rdp/refs/heads/main/start.bat -OutFile start.bat
        Invoke-WebRequest https://raw.githubusercontent.com/HenCodersDeveloper/Rdp/refs/heads/main/loop.bat -OutFile loop.bat

    - name: Setup RDP Access
      run: |
        Set-ItemProperty -Path 'HKLM:\System\CurrentControlSet\Control\Terminal Server' -Name "fDenyTSConnections" -Value 0
        Enable-NetFirewallRule -DisplayGroup "Remote Desktop"
        Set-ItemProperty -Path 'HKLM:\System\CurrentControlSet\Control\Terminal Server\WinStations\RDP-Tcp' -Name "UserAuthentication" -Value 1

    - name: Start Serveo Tunnel
      run: |
        echo y | ssh -R 3389:localhost:3389 serveo.net > serveo_log.txt 2>&1
      env:
        SSH_AUTH_SOCK: ""

    - name: Display Serveo Subdomain
      run: |
        echo Serveo Tunnel Information:
        findstr "Forwarding" serveo_log.txt || echo "Serveo Tunnel Error: Please check the SSH connection."
        echo Access RDP using the subdomain displayed above.

    - name: Run Start Script
      run: cmd /c start.bat

    - name: Run Loop Script
      run: cmd /c loop.bat
